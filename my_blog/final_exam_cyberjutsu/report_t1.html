

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Report_t1 - My Blog</title>

  <meta name="description" content="PENTEST REPORT
Ngày 07 tháng 12 năm 2024 
Mô tả
Báo cáo này mô tả chi tiết quá trình và kết quả kiểm thử ứng dụng T1 Merchandises
Đối tượng

t1shop.exam.cyberjutsu-lab.tech
*.exam.cyberjutsu-lab.tech

Công cụ: Burpsuit, IntelliJ IDEA, VS Code,  DevTools
Mục Lục


Tổng quan


Phạm vi"><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "My Blog",
    
    "url": "https:\/\/tranphongktmm.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/tranphongktmm.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/tranphongktmm.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/tranphongktmm.github.io\/my_blog\/final_exam_cyberjutsu\/report_t1.html",
          "name": "Report t1"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "Report_t1",
  "description" : "PENTEST REPORT Ngày 07 tháng 12 năm 2024 Mô tả Báo cáo này mô tả chi tiết quá trình và kết quả kiểm thử ứng dụng T1 Merchandises\nĐối tượng t1shop.exam.cyberjutsu-lab.tech *.exam.cyberjutsu-lab.tech Công cụ: Burpsuit, IntelliJ IDEA, VS Code, DevTools\nMục Lục Tổng quan\nPhạm vi\n",
  "inLanguage" : "en",
  "wordCount":  2373 ,
  "datePublished" : "2024-12-20T00:04:05\u002b07:00",
  "dateModified" : "2024-12-20T00:04:05\u002b07:00",
  "image" : "https:\/\/tranphongktmm.github.io\/img\/avatar-icon.png",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/tranphongktmm.github.io\/my_blog\/final_exam_cyberjutsu\/report_t1.html",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/tranphongktmm.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/tranphongktmm.github.io\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Report_t1" />
<meta property="og:description" content="PENTEST REPORT
Ngày 07 tháng 12 năm 2024 
Mô tả
Báo cáo này mô tả chi tiết quá trình và kết quả kiểm thử ứng dụng T1 Merchandises
Đối tượng

t1shop.exam.cyberjutsu-lab.tech
*.exam.cyberjutsu-lab.tech

Công cụ: Burpsuit, IntelliJ IDEA, VS Code,  DevTools
Mục Lục


Tổng quan


Phạm vi">
<meta property="og:image" content="https://tranphongktmm.github.io/img/avatar-icon.png" />
<meta property="og:url" content="https://tranphongktmm.github.io/my_blog/final_exam_cyberjutsu/report_t1.html" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="My Blog" />

  <meta name="twitter:title" content="Report_t1" />
  <meta name="twitter:description" content="PENTEST REPORT
Ngày 07 tháng 12 năm 2024 
Mô tả
Báo cáo này mô tả chi tiết quá trình và kết quả kiểm thử ứng dụng T1 Merchandises
Đối tượng

t1shop.exam.cyberjutsu-lab.tech
*.exam.cyberjutsu-lab.tech …&lt;/!--&gt;">
  <meta name="twitter:image" content="https://tranphongktmm.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://tranphongktmm.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.139.3">
  <link rel="alternate" href="https://tranphongktmm.github.io/index.xml" type="application/rss+xml" title="My Blog"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="https://tranphongktmm.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://tranphongktmm.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://tranphongktmm.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tranphongktmm.github.io/">My Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="My Blog" href="https://tranphongktmm.github.io/">
            <img class="avatar-img" src="https://tranphongktmm.github.io/img/avatar-icon.png" alt="My Blog" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="my_blog-heading">
              
                <h1>Report_t1</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h1 id="pentest-report"><strong>PENTEST REPORT</strong></h1>
<h2 id="insngày-07-tháng-12-năm-2024-ins"><strong><!-- raw HTML omitted -->Ngày 07 tháng 12 năm 2024 <!-- raw HTML omitted --></strong></h2>
<h3 id="mô-tả"><strong>Mô tả</strong></h3>
<p>Báo cáo này mô tả chi tiết quá trình và kết quả kiểm thử ứng dụng T1 Merchandises</p>
<h3 id="đối-tượng"><strong>Đối tượng</strong></h3>
<ul>
<li><strong><!-- raw HTML omitted -->t1shop.exam.cyberjutsu-lab.tech<!-- raw HTML omitted --></strong></li>
<li><strong><!-- raw HTML omitted -->*.exam.cyberjutsu-lab.tech<!-- raw HTML omitted --></strong></li>
</ul>
<p><strong>Công cụ:</strong> Burpsuit, IntelliJ IDEA, VS Code,  DevTools</p>
<h3 id="mục-lục"><strong>Mục Lục</strong></h3>
<ol>
<li>
<p><strong>Tổng quan</strong></p>
</li>
<li>
<p><strong>Phạm vi</strong></p>
</li>
<li>
<p><strong>Lỗ hổng</strong></p>
<p><strong>T1-07-001: Source code disclosure at  <code>https://cdn-t1shop.exam.cyberjutsu-lab.tech/</code> due to exposing .git folder</strong></p>
<p><strong>T1-07-002: Server-Side Request Forgery (SSRF) at  <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/images?file=</code> leads to read any files</strong></p>
<p><strong>T1-07-003: Broken Access Control at  <code>https://t1shop.exam.cyberjutsu-lab.tech/</code> leads to log as admin</strong></p>
<p><strong>T1-07-004:  SQL Injection at <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/profile</code> leads to change admin’s password</strong></p>
<p><strong>T1-07-005:  Missing authentication at all admin’s API on  <code>https://t1shop.exam.cyberjutsu-lab.tech/</code></strong></p>
<p><strong>T1-07-006:  SQL Injection at <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/profile</code> leads to database dumping</strong></p>
<p><strong>T1-07-007:  Insecure Deserialization at <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/admin/generate-password?config=</code> leads to RCE</strong></p>
</li>
<li>
<p><strong>Kết luận</strong></p>
</li>
</ol>
<!-- raw HTML omitted -->
<p><strong>1. Tổng quan</strong></p>
<p><code>T1 Merchandises là ứng dụng thương mại điện tử, cho phép người dùng mua sắm các sản phẩm của đội tuyển T1</code></p>
<p>Báo cáo này liệt kê các lỗ hổng bảo mật và những vấn đề liên quan được tìm thấy trong quá trình kiểm thử ứng dụng T1 Merchandises trên máy tính.</p>
<p>Mỗi lỗ hổng bảo mật được cung cấp một mã lỗi nhằm mục đích quản lý và theo dõi trong tương lai.
Các mã lỗi trong báo cáo được đánh số theo thứ tự thời gian tìm ra lỗi.</p>
<p>Quá trình kiểm thử được thực hiện dưới hình thức blackbox testing.</p>
<p><strong>2. Phạm vi</strong></p>
<table>
  <thead>
      <tr>
          <th>Đối tượng</th>
          <th>Môi trường</th>
          <th>Phiên bản</th>
          <th>Special privileges</th>
          <th>Source code</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>T1 Merchandises</td>
          <td>Web</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
      </tr>
  </tbody>
</table>
<p><strong>3. Lỗ hổng</strong></p>
<p><strong>T1-07-001: Source code disclosure at  <code>https://cdn-t1shop.exam.cyberjutsu-lab.tech/</code> due to exposing .git folder</strong></p>
<p><strong>Description and impact</strong></p>
<p>Rất có thể do anh dev cấu hình sai hoặc khi setup server quên không xóa <code>.git</code> folder, thư mục này cho phép người dùng dễ dàng tải về toàn bộ mã nguồn của dự án. Với mã nguồn này thì những thông tin nhạy cảm như secret key, password, cơ sở dữ liệu, logic chương trình, &hellip; sẽ giúp cho kẻ tấn công tiếp tục khai thác sâu vào hệ thống.</p>
<p><strong>Steps to reproduce</strong></p>
<p>Khi thực hiện directory scan <code>https://cdn-t1shop.exam.cyberjutsu-lab.tech/</code> xuất hiện thư mục <code>.git</code>:</p>
<p><img src="image.png" alt="alt text"></p>
<p>Dùng <code>git-dumper</code> để kéo code về về thư mục <code>./source</code>, thực hiện câu lệnh:  <code>git-dumper https://cdn-t1shop.exam.cyberjutsu-lab.tech/.git/ ./source</code></p>
<p><img src="image-1.png" alt="alt text">
<code>Code khi đã dùng git-dumper để kéo về</code></p>
<p>Trong file <code>source/src/main/java/com/cbjs/controller/OrderResource.java</code>:</p>
<p><img src="image-2.png" alt="alt text"></p>
<p>Tại dòng 29, với <em>annotation</em> <code>@RequestMapping(&quot;/v1/orders&quot;)</code> được khai báo sẽ ánh xạ URL <code>/v1/orders</code> tới các phương thức  xử lý yêu cầu HTTP. Từ dòng 38 đến 49, tại đây website thực hiện method <code>GET</code> với <em>annotation</em> <code>@GetMapping</code> để lấy ra tất cả các <code>orders</code> thông qua hàm <code>getAllOrders()</code> trong file <code>OrderService.java</code>.</p>
<p>Ta sẽ đăng nhập vào trang web và mua sản phẩm:</p>
<p><img src="image-3.png" alt="alt text"></p>
<p>Sau khi mua, ta sẽ vào <code>https://t1shop.exam.cyberjutsu-lab.tech/orders</code> để xem những hàng đã mua, sau khi bấm vào id do <code>UUID</code> tạo ra, lúc này sẽ có 2 requests được gửi về server, 1 request là các mặt hàng mà mình qua endpoint <code>/api/v1/orders/history</code> đã mua và 1 request là details của từng mặt hàng tại endpoint <code>/api/v1/orders/details/{id}</code>:</p>
<p><img src="image-4.png" alt="alt text"></p>
<p>Thực hiện GET tới <code>/api/v1/orders</code> để list ra tất cả các orders hiện có:</p>
<p><img src="image-5.png" alt="alt text">
<code>Danh sách các orders khi thực hiện GET /api/v1/orders</code></p>
<p>Tiếp đó, thay id order <code>a0fc5210-b856-4de1-bf4c-82a53de0b369</code> của admin <code>userId=1</code> vào endpoint <code>/api/v1/orders/details/{id}</code> để lấy flag:</p>
<p><img src="image-6.png" alt="alt text">
<code>Flag 1: CBJS{5316332946801a57df0d8d6ee1e00b10}</code></p>
<p><strong>Recommendations</strong></p>
<ul>
<li>Xóa thư mục <code>.git</code> ở <code>https://cdn-t1shop.exam.cyberjutsu-lab.tech/.git/</code>.</li>
<li>Đảm bảo kiểm tra và xóa các file, các folder không cần thiết trước khi deploy ứng dụng lên server.</li>
</ul>
<p><strong>T1-07-002: Server-Side Request Forgery (SSRF) at  <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/images?file=</code> leads to read any files</strong></p>
<p><strong>Description and impact</strong></p>
<p>Do web server xử lý các link ảnh không cẩn thận, ngoài ra còn xử lý các URI scheme / protocol khác nhau, dẫn đến kẻ tấn công có thể lợi dụng điều này để thực hiện giả danh server để đọc các file bất kì trên server.</p>
<p><strong>Steps and reproduce</strong></p>
<p>Vào file <code>source/src/main/java/com/cbjs/controller/ImageResource.java</code> để đọc mã nguồn.</p>
<p><img src="image-7.png" alt="alt text">
<code>Code file ImageResource.java</code></p>
<p>Tại đây, server nhận vào 1 param <code>file</code> với method <code>GET</code> và ghi <code>imageBytes</code> và  <code>contentType</code> của link ảnh thông qua hàm <code>loadImageFromUrl</code> và <code>getContentType</code>, sau đó sẽ trả lại 1 chuỗi trong đó <code>imageBytes</code> đã được base64 encode.</p>
<p>Ta sẽ vào file <code>source/src/main/java/com/cbjs/service/ImageService.java</code> để hiểu rõ hơn về các hàm xử lý trên.</p>
<p><img src="image-8.png" alt="alt text"></p>
<p>Tại đây kết nối tới link được đưa vào thông qua class <code>URL</code>, và lấy dữ liệu thông qua hàm <code>getInputStream</code>. Ta biết rằng ngoài các protocol <code>http://</code> và <code>https://</code>, <code>URL</code> còn hỗ trợ các protocol khác như <code>file://</code>:</p>
<p><img src="image-9.png" alt="alt text">
<code>Các protocol mà class URL hỗ trợ</code> <!-- raw HTML omitted --><a href="https://web.archive.org/web/20051219043731/http://archive.ncsa.uiuc.edu/SDG/Software/Mosaic/Demo/url-primer.html">https://web.archive.org/web/20051219043731/http://archive.ncsa.uiuc.edu/SDG/Software/Mosaic/Demo/url-primer.html</a><!-- raw HTML omitted --></p>
<p>Ta sẽ thực hiện gửi payload <code>file:///etc/passwd</code> thông qua param <code>file</code> để đọc nội dung của file <code>/etc/passwd</code>.</p>
<p><img src="image-10.png" alt="alt text"></p>
<p>Server sẽ trả lại cho ta nội dung dạng base64, decode để xem nội dung và đọc flag:</p>
<p><img src="image-11.png" alt="alt text">
<code>Flag 2: CBJS{c60c9c16178b92c79d43f6711d87df21}</code></p>
<p><strong>Recommendations</strong></p>
<ul>
<li>Chỉ cho phép <code>http</code> và <code>https</code>, kiểm tra dữ liệu vào có extension và signature có cùng định dạng là file ảnh</li>
<li>Chỉ cho phép truy cập vào những domain trong whitelist được cho phép</li>
</ul>
<p><strong>T1-07-003: Broken Access Control at  <code>https://t1shop.exam.cyberjutsu-lab.tech/</code> leads to log as admin</strong></p>
<p><strong>Description and impact</strong></p>
<p>Rất có thể do anh dev cấu hình sai trên <code>https://t1shop.exam.cyberjutsu-lab.tech/</code>, kẻ tấn công có thể sử dụng kỹ thuật bruteforce để tìm ra những đường dẫn phổ biến trên server, từ đó tìm được các thông tin quan trọng để tạo ra token của admin và đăng nhập vào account admin.</p>
<p><strong>Steps to reproduce</strong></p>
<p>Khi truy cập vào <code>https://t1shop.exam.cyberjutsu-lab.tech/robots.txt</code>, ở file này chứa disallow endpoint:</p>
<p><img src="image-12.png" alt="alt text">
<code>Đường dẫn /robots.txt ở trang web https://t1shop.exam.cyberjutsu-lab.tech</code></p>
<p>Sau khi truy cập vào đường dẫn disallow <code>https://t1shop.exam.cyberjutsu-lab.tech/api/swagger-ui/index.html</code>, tại đây có 1 đường dẫn chứa thông tin của admin:</p>
<p><img src="image-13.png" alt="alt text">
<code>Đường dẫn /api/swagger-ui/index.html ở trang web https://t1shop.exam.cyberjutsu-lab.tech</code></p>
<p>Truy cập vào đường dẫn <code>https://t1shop.exam.cyberjutsu-lab.tech/api/api-docs</code> để lấy email của admin:</p>
<p><img src="image-14.png" alt="alt text">
<code>&quot;email&quot;: &quot;admin@t1store.com&quot;</code></p>
<p>Thông thường JWT token được tạo ra bởi 3 phần:</p>
<ul>
<li><code>Header</code> chứa thuật toán mã hóa</li>
<li><code>Payload</code> chứa thông tin</li>
<li><code>Signature</code> chứa dữ liệu đã mã hóa <code>HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), secretKey )</code></li>
</ul>
<p>Mỗi phần được ngăn cách bởi 1 dấu <code>.</code>. Base64 decode JWT token tạo mỗi lần đăng nhập để xem chi tiết:</p>
<p><img src="image-15.png" alt="alt text">
<code>Kết quả sau khi base64 decode JWT token của user</code></p>
<p>Vậy là đã tìm được phần <code>Header</code>, <code>Payload</code>, cùng với <code>Secret Key</code> tìm thấy trong source code trong file <code>source/src/main/resources/application.properties</code>:</p>
<p><img src="image-16.png" alt="alt text">
<code>jwt.secret.key=f1e2958ab8ca0fb597eaf381a7d8126317ae3db94d120c531a7a391cb02c9e2c</code></p>
<p>Tạo token của admin:</p>
<p><img src="image-17.png" alt="alt text">
<code>Token admin: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbkB0MXN0b3JlLmNvbSIsImlhdCI6MTczMzU4NTg4NywiZXhwIjoxNzMzNjcyMjg3fQ.D0Zx417Z0ekyD2k10HMA0knjexXesY8SAlmFaWl5r00</code></p>
<p>Nhập token vào local storage và đăng nhập với tư cách admin:</p>
<p><img src="image-18.png" alt="alt text">
<code>Đăng nhập vào tài khoản admin bằng token</code></p>
<p>Đọc flag 3 ở trang chủ của admin:</p>
<p><img src="image-20.png" alt="alt text">
<img src="image-19.png" alt="alt text">
<code>Flag 3: CBJS{c58ee619cca037f0bb5a45c8517f6636}</code></p>
<p>Đọc được cả flag 1 ở trang orders của admin:</p>
<p><img src="image-29.png" alt="alt text">
<code>Flag 1: CBJS{5316332946801a57df0d8d6ee1e00b10}</code></p>
<p><strong>Recommendations</strong></p>
<ul>
<li>Kiểm tra, xóa các file, endpoint không cần thiết trước khi deploy ứng dụng</li>
<li>Xét quyền cho các file, thư mục quan trọng để tránh rò rỉ các thông tin quan trọng</li>
<li>Không lưu secret key trong source</li>
</ul>
<p><strong>T1-07-004:  SQL Injection at <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/profile</code> leads to change admin’s password</strong></p>
<p><strong>Description and impact</strong></p>
<p>Web server nhận vào tham số POST <code>name</code> trong API <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/profile</code> không được sàng kỹ sang khi thực hiện truy vấn dữ liệu, kẻ tấn công lợi dụng điều này để thay đổi password của admin,đăng nhập với tư cách admin thực hiện các hành động trái phép hoặc phá hoại.</p>
<p><strong>Steps to reproduce</strong></p>
<p>Khi thực hiện <em>edit profile</em> tại trường <em>name</em>, ứng dụng gửi request POST đến API <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/profile</code>. Dưới đây là request khi người dùng <em>edit profile</em>:</p>
<p><img src="image-21.png" alt="alt text"></p>
<p>Trong source code, đọc file <code>source/com/cbjs/service/UserService.java</code> để hiểu rõ logic xử lý:</p>
<p><img src="image-23.png" alt="alt text">
<code>Đoạn code từ dòng 85-109</code></p>
<p>Sau khi nhận giá trị tham số POST <code>name</code>, kiểm tra các chuỗi nguy hiểm <code>dangerous</code> nếu có sẽ bắn exception <code>Invalid characters in name</code>, kiểm tra <code>name</code> có khác <code>null</code> không, nếu khác sẽ xóa các kí tự trong <code>regex</code> thông qua hàm <code>replaceAll</code> và chèn vào câu query. Nhưng vẫn bypass được:</p>
<ul>
<li><code>pass#word</code> khi qua các hàm filter sẽ thành <code>password</code></li>
<li>Dấu <code>/**/</code> thay thế cho dấu space đã bị filter</li>
</ul>
<p>Payload sẽ dạng : <code>a',pass#word=''/**/where/**/id=1/**/--</code></p>
<p>Do password của user trong database được lưu dưới dạng <code>BCryptPasswordEncoder</code></p>
<p><img src="image-24.png" alt="alt text">
<img src="image-25.png" alt="alt text">
<img src="image-26.png" alt="alt text"></p>
<p>Và khi validate user khi đăng nhập:</p>
<p><img src="image-27.png" alt="alt text">
<code>Kiểm tra password thông qua hàm matches</code></p>
<p>Do đó ta sẽ insert password của admin là dạng mã <code>BCryptPasswordEncoder</code> của <code>a</code> là <code>$2a$12$cY9gDi7B26UVZRIpQdKdEOO6zrl1mowaO.ZTVm.7sl.6.ZLEO9x6K</code></p>
<p>Vậy payload hoàn chỉnh: <code>a',pass#word='$2a$12$cY9gDi7B26UVZRIpQdKdEOO6zrl1mowaO.ZTVm.7sl.6.ZLEO9x6K'/**/where/**/id=1/**/--</code></p>
<p>Nhưng chắc là do anh dev set time reset password của admin khoảng dưới 40s, nên hãy đăng nhập trong khoảng thời gian đó.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><code>Thành công đăng nhập vào account admin</code></p>
<p>Đọc flag 1 và flag 3:</p>
<p><img src="image-28.png" alt="alt text">
<code>Flag 3: CBJS{c58ee619cca037f0bb5a45c8517f6636}</code></p>
<p><img src="image-29.png" alt="alt text">
<code>Flag 1: CBJS{5316332946801a57df0d8d6ee1e00b10}</code></p>
<p><strong>Recommendations</strong></p>
<ul>
<li>
<p>Thay đổi câu truy vấn thành dạng <em>Parameterized Query</em> hoặc <em>Stored Procedures</em> để phòng chống SQL Injection</p>
</li>
<li>
<p>Validate thêm dấu <code>'</code>, nhốt tham số <code>name</code> trong dấu <code>''</code> để không kéo dài được câu truy vấn</p>
</li>
<li>
<p>Kết hợp xác thực đa yếu tố như gửi OTP qua email hoặc SMS</p>
</li>
</ul>
<p><strong>T1-07-005:  Missing authentication at all admin’s API on  <code>https://t1shop.exam.cyberjutsu-lab.tech/</code></strong></p>
<p><strong>Description and impact</strong></p>
<p>Sau khi truy cập được account admin ở 2 lỗ hổng <strong>T1-07-003</strong> và <strong>T1-07-004</strong> và truy cập vào admin panel <code>https://t1shop.exam.cyberjutsu-lab.tech/admin/</code>, ta thấy tất cả các chức năng của admin không cần xác thực vẫn có thể sử dụng được. Kẻ tấn công có thể
tận dụng các chức năng của admin để cướp account tất cả người dùng, lấy thông tin khách hàng.</p>
<p><strong>Steps to reproduce</strong></p>
<p>Truy cập đường dẫn <code>https://t1shop.exam.cyberjutsu-lab.tech/admin/users</code>, ứng dụng sẽ gửi request tới API <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/admin/users</code> hiển thị ra tất cả thông tin của mọi users trong ứng dụng :</p>
<p><img src="image-30.png" alt="alt text">
<code>Danh sách của tất cả users</code></p>
<p>Từ những thông tin đó kẻ tấn công có thể tận dụng lỗ hổng <strong>T1-07-003</strong> và <strong>T1-07-004</strong> như phân tích ở trên để có thể truy cập vào, cũng như chiếm account của tất cả users trong ứng dụng.</p>
<p><strong>Recommendations</strong></p>
<ul>
<li>Triển khai cơ chế xác thực đối với các API của admin.</li>
<li>Trong trường hợp không còn sử dụng, không chỉ disable trên giao diện front-end mà còn phải tắt các API trên back-end.</li>
</ul>
<p><strong>T1-07-006:  SQL Injection at <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/profile</code> leads to database dumping</strong></p>
<p><strong>Description and impact</strong></p>
<p>Web server nhận vào tham số POST <code>name</code> trong API <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/profile</code> không được sàng kỹ sang khi thực hiện truy vấn dữ liệu, kẻ tấn công lợi dụng điều này để lấy tất cả dữ liệu trong cơ sở dữ liệu.</p>
<p><strong>Steps to reproduce</strong></p>
<p>Khi thực hiện <em>edit profile</em> tại trường <em>name</em>, ứng dụng gửi request đến API <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/profile</code>. Dưới đây là request khi người dùng <em>edit profile</em>:</p>
<p><img src="image-31.png" alt="alt text">
<code>Request được gửi tới server khi update name của user</code></p>
<p>Từ lỗ hổng 1, đọc file <code>source/com/cbjs/service/UserService.java</code> để hiểu rõ logic xử lý:</p>
<p><img src="image-23.png" alt="alt text">
<code>Đoạn code từ dòng 85-109</code></p>
<p>Sau khi nhận giá trị tham số POST <code>name</code>, kiểm tra các chuỗi nguy hiểm <code>dangerous</code> nếu có sẽ bắn exception <code>Invalid characters in name</code>, kiểm tra <code>name</code> có khác <code>null</code> không, nếu khác sẽ xóa các kí tự trong <code>regex</code> với hàm <code>replaceAll</code>và chèn vào câu query. Nhưng vẫn bypass được.</p>
<p>Ta sẽ thay đổi tham POST <code>name</code> để thực hiện dump các table của database hiên tại:</p>
<p><img src="image-32.png" alt="alt text">
<code>Các table được dump ra từ database hiện tại</code></p>
<p>Tiếp tục, đọc các cột tại table <code>t1_secret</code>:</p>
<p><img src="image-33.png" alt="alt text">
<code>Cột id,secret được dump từ bảng t1_secret</code></p>
<p>Đọc flag tại cột <code>secret</code>:</p>
<p><img src="image-34.png" alt="alt text">
<code>Flag 4: CBJS{af318b13e50999e637098787bb0f4c53}</code></p>
<p><strong>Recommendations</strong></p>
<ul>
<li>
<p>Thay đổi câu truy vấn thành dạng <em>Parameterized Query</em> hoặc <em>Stored Procedures</em> để phòng chống SQL Injection</p>
</li>
<li>
<p>validate thêm dấu <code>'</code>, để nhốt tham số <code>name</code> trong dấu <code>''</code></p>
</li>
</ul>
<p><strong>T1-07-007:  Insecure Deserialization at <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/admin/generate-password?config=</code> leads to RCE</strong></p>
<p><strong>Description and impact</strong></p>
<p>Sau khi đăng nhập vào account admin, thực hiện chức năng generate password tại <code>https://t1shop.exam.cyberjutsu-lab.tech/admin/generate-password</code>, server nhận vào tham số
không được sàng lọc khi thực hiện deserialize dữ liệu, kẻ tấn công sẽ lợi dụng điểm này và hành vi sẵn có của chương trình để thay đổi logic chương trình dẫn tới RCE.</p>
<p><strong>Steps and reproduce</strong></p>
<p>Vào file <code>source/src/main/java/com/cbjs/service/AdminService.java</code> để đọc mã nguồn:</p>
<p><img src="image-35.png" alt="alt text">
<code>Dòng code 35 đến 57 của trang generate password của admin</code></p>
<p>Tại đây, hàm <code>generateConfig</code> nhận vào các thông tin từ client gửi tới server qua <code>HttpServletRequest</code>, khởi tạo class <code>PasswordConfig</code> tại file <code>source/src/main/java/com/cbjs/entity/PasswordConfig.java</code>, sau đó sẽ trả lại dữ liệu config đã serialize dưới dạng base64 qua hàm <code>serializeToBase64</code>:</p>
<p><img src="image-37.png" alt="alt text">
<code>Code xử lý serialize và deserialize</code></p>
<p><img src="image-36.png" alt="alt text">
<code>Code của class PasswordConfig</code></p>
<p>Bao gồm thuộc tính <code>length</code> ( khá kì lạ khi khai báo là <code>String</code>) và các thuộc tính nhận vào giá trị <code>boolean</code> để set giá trị cho <code>charset</code> bên dưới.</p>
<p>Tiếp đó, hàm <code>generatePassword</code>:</p>
<p><img src="image-38.png" alt="alt text">
<code>Dòng code 59 đến 74 của trang generate password của admin</code></p>
<p>Nhận vào tham số GET <code>config</code>, thực hiện deserialize qua hàm <code>deserializeFromBase64</code>, đưa giá trị đã deserialize làm giá trị đầu vào của class <code>PasswordGenerator</code> tại file <code>source/src/main/java/com/cbjs/entity/PasswordGenerator.java</code> và thực hiện hàm <code>generate</code>:</p>
<p><img src="image-39.png" alt="alt text">
<code>Code xử lý của hàm generate trong file PasswordGenerator.java</code></p>
<p>Sau khi lấy ra <code>length</code> và <code>charset</code>, và đưa vào <code>cmd</code> thực hiện OS command qua thông qua <code>ProcessBuilder</code>. Do ta có thể kiểm soát <code>length</code> có kiểu dữ liệu <code>String</code> nên ở đây bị Command Injection</p>
<p>Kết hợp 2 lỗ hổng trên để khai thác. Thực hiện thay đổi giá trị tham số GET <code>length</code> tại API <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/admin/generate-config</code> để tạo payload:</p>
<p><img src="image-44.png" alt="alt text">
<code>length được thay đổi thành ;sudo+/readflag</code></p>
<p>Đưa kết quả config vào API <code>https://t1shop.exam.cyberjutsu-lab.tech/api/v1/admin/generate-password?config=</code> để đọc flag:</p>
<p><img src="image-45.png" alt="alt text">
<code>Flag 5: CBJS{073035a8adbf98e90dc893c284788824}</code></p>
<p><strong>Recommendations</strong></p>
<ul>
<li>Thay đổi kiểu dữ liệu của <code>length</code> từ dạng chuỗi sang dạng số.</li>
<li>Thay đổi ánh xạ <code>%s</code>của <code>length</code>trong <code>cmd</code> thành <code>%d</code>.</li>
</ul>
<p><strong>4. Kết luận</strong></p>
<p>Thông qua bản báo cáo này, mình đã thành công tìm ra các lỗi bảo mật khác nhau nhằm đánh giá sát sao và đưa ra một cái nhìn dễ hiểu và trực quan nhất nhằm giúp người đọc có thể nhìn thấy và đánh giá những rủi ro trong ứng dụng T1 Merchandises.</p>
<p>Từ những lỗi tìm được, mình nhận thấy các file, thư mục và endpoint chưa được kiểm tra cẩn thận trước khi deploy và các giá trị đầu vào từ phía người dùng gửi tới server không thường được validate cẩn thận trước khi xử lý, dẫn đến những rủi ro như hiện tại và có thể xảy ra trong tương lai. Những rủi ro trên có thể gây thiệt hại cho cả 2 phía: server và người dùng.</p>
<p>Hy vọng rằng những phát hiện và giải pháp được đề xuất trong báo cáo này sẽ đóng góp vào việc nâng cao an toàn và giảm thiểu rủi ro cho hệ thống trong tương lai.</p>


        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2ftranphongktmm.github.io%2fmy_blog%2ffinal_exam_cyberjutsu%2freport_t1.html&amp;text=Report_t1&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftranphongktmm.github.io%2fmy_blog%2ffinal_exam_cyberjutsu%2freport_t1.html" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2ftranphongktmm.github.io%2fmy_blog%2ffinal_exam_cyberjutsu%2freport_t1.html&amp;title=Report_t1" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ftranphongktmm.github.io%2fmy_blog%2ffinal_exam_cyberjutsu%2freport_t1.html&amp;title=Report_t1" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2ftranphongktmm.github.io%2fmy_blog%2ffinal_exam_cyberjutsu%2freport_t1.html&amp;title=Report_t1" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2ftranphongktmm.github.io%2fmy_blog%2ffinal_exam_cyberjutsu%2freport_t1.html&amp;description=Report_t1" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://tranphongktmm.github.io/my_blog/koinbase/report_koinbase.html" data-toggle="tooltip" data-placement="top" title="Report_koinbase">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      
      
      
      
      
        
      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2024
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://tranphongktmm.github.io/">My Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.139.3</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://tranphongktmm.github.io/js/main.js"></script>
<script src="https://tranphongktmm.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://tranphongktmm.github.io/js/load-photoswipe.js"></script>










    
  </body>
</html>

